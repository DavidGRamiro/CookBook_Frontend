<app-navbar></app-navbar>


<div class="container mt-5 mb-5">
  <div class="row">
    <!-- Primer bloque, que recoge la imagen y los ingredientes que necesita la receta -->
    <div class="col" style="background-color: cadetblue;">
      <h3 class="text-center m-5">{{receta.nombre }}</h3>
      <div class="row">
        <div class="text-center">
          <img [src]= receta.imagen style="width: 80%; border-radius: 10px;">
        </div>
        <div class ="mt-2 ml-7">
          <p-chip label="{{ receta.usuario.username }}" image="{{ receta.usuario.imagen }}"></p-chip>
        </div>
        <p-divider></p-divider>
        <!-- Sección bajo la imagen de la receta -->
      </div>
      <div>
        <h4>Ingredientes</h4>
        <ul>
          <li *ngFor="let item of receta.recetasConIngredientes">
              {{ item.ingrediente.nombre}} : {{  cantidad }} {{ item.unidadMedida }}
          </li>
        </ul>
      </div>
    </div>

    <!-- Segundo bloque que recoge las intrucciones de la receta -->
    <div class="col" style="background-color: aqua;">
      <h3 class ="text-center">¿Por donde empezamos?</h3>
      <div class="mt-8">
        <ul>
          <li *ngFor = "let instruccion of instruciones">
            {{ instruccion }}
          </li>
        </ul>
      </div>
      <div class="row">
        <div class="col">
          <h3>Macronutrientes</h3>
            <p> Calorias {{ calorias }}</p>
            <p> Grasas {{ grasas }}</p>
            <p> Carbohidratos {{ carbohidratos }}</p>
            <p> Proteinas {{ proteinas }}</p>
        </div>
        <div class="col">
          <h3>Modificar</h3>
          <p>Esta receta está pensada para una ración por persona</p>
          <div class ="text-center">
            <!-- Botón para imcrementar el numero de raciones -->
            <p-inputNumber [(ngModel)]="valor" (ngModelChange)="actualizarMacros()"
                          [showButtons]="false"
                          inputId="stacked"
                          [min] ="1"  [max]="10"
                          [inputStyle]="{ 'width':'50%', 'height': '50%','background-color':'#fff3cd', 'border-radius':'3px'}"
                          [style]="{'width':'50%' ,'height': '50%',}"> </p-inputNumber>
          </div>
        </div>
      </div>
      <div>
        <h4 class ="text-center">Comentarios de usuarios</h4>
        <div class="card">
          <p-tabView (click)="obtenerComentarios(receta.idReceta)">
                <p-tabPanel header="Deja tu opinion" *ngIf="usuarioLogueado; else noLogin">
                    <form [formGroup]="formComentario" id="formularioComentario">
                        <span class="p-float-label mt-3">
                          <textarea id="float-input" rows="5" cols="80%" pInputTextarea  [autoResize]="true" formControlName="textoComentario"></textarea>
                          <label for="float-input">Escribe aquí tu comentario</label>
                        </span>
                      <button type="submit" (click)="subirComentario()">Subir comentario</button>
                    </form>
                  </p-tabPanel>
                  <ng-template #noLogin>
                    <p-tabPanel header="Deja tu opinion">
                      <p>Para poder comentar debes estar logueado</p>
                    </p-tabPanel>
                  </ng-template>
              <p-tabPanel header="Comentarios de usuarios">
                <p *ngFor="let comentario of comentario | slice:first:first + pageSize">
                  <p-avatar image="{{ comentario.usuario.imagen }}" styleClass="mr-2" shape="circle"></p-avatar>
                  {{ comentario.textoComentario }}
                </p>
                <p-paginator [first]="first" [rows]="pageSize" [totalRecords]="totalRecords" (onPageChange)="first = $event.first"></p-paginator>
              </p-tabPanel>
          </p-tabView>
      </div>
      </div>
    </div>
  </div>
</div>

<p-toast></p-toast>
<app-footer></app-footer>
